## 7.1 테스트 피라미드

테스트는 비용이 많이 드는 테스트는 지양하고 비용이 적게드는 테스트를 많이 만들어야 한다. 단위와 단위를 넘는 경계를 결합하는 테스트는 비용이 비싸지고 설정 에러로 인해 실행이 더 느려진다.

1. 단위테스트 : 피라미드의 토대. 일반적으로 하나의 클래스를 인스턴스화하고 인터페이스를 통해 기능 테스트
2. 통합 테스트 : 연결된 여러 유닛을 인스턴스화 하는 클래스의 인터페이스로 데이터를 보내 여러 계층에 걸쳐서 테스트한다.
3. 시스템 테스트 : 애플리케이션을 구성하는 모든 객체 네트워크를 가동시켜서 특정 유스케이스가 전 계층에 잘 동작하는지 검증한다.

그 위에는 UI를 포함한 엔드투엔드 테스트 층이 있다.

## 7.1 단위 테스트로 도메인 엔티티 테스트하기

## 7.2 단위 테스트로 유스케이스 테스트하기

목 객체를 만들어서 특정 상태를 검증해야하는 경우 의존 대상의 특정 메소드와 상호작용 했는지 여부를 검증한다.

## 7.3 통합 테스트로 웹 어댑터 테스트하기

MockMvc 객체를 이용해 모킹해서 반환 값이 기대 응답인지 확인한다.

하나의 웹 컨트롤러만 테스트한 것처럼 보이지만 전체 객체 네트워크를 인스턴스화하도록 만들기 때문에 단위 테스트가 아니라 통합 테스트이다.

## 7.4 통합 테스트로 영속성 어댑터 테스트하기

이때는 어댑터의 로직 뿐 아니라 데이터베이스 매핑도 검증하기 때문에 단위 테스트보다는 통합 테스트를 적용한다.

@DataJpaTest로 데이터베이스 접근에 필요한 객체들을 인스턴스화 하고 @Import 로 특정 객체를 추가한다.

sql 스크립트로 데이터베이스를 특정 상태로 만든 후 검증한다.

스프링은 인메모리 디비로 테스트하지만 실제로는 다른 디비를 사용하기 때문에 문제를 발생할 수도 있어 영속성 어댑터 테스트는 실제 디비를 대상으로 테스트해야하고, 도커 컨테이너를 띄워서 하는 등의 테스트를 진행한다.

## 7.5 시스템 테스트로 주요 경로 테스트하기

@SpringBootTest로 모든 객체를 띄우고 실제로 HTTP 통신을 통해 요청하고 응답을 검증한다.

유저입장에서 보는 테스트가 가능해지고 여러 유스케이스를 결합해서 시나리오를 만드는 경우 배포될 준비가 되었다는 확인을 할 수 있다.

## 7.6 얼마만큼의 테스트가 충분할까?

1. 도메인 엔티티를 구현할 때에는 단위 테스트로 커버하자.
2. 유스케이스를 구현할 때에는 단위 테스트로 커버하자.
3. 어댑터를 구현할 때는 통합 테스트로 커버하자.
4. 사용자가 취할 수 있는 중요 애플리케이션 경로는 시스템 테스트로 커버하자.

## 7.7 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

입출력 포트는 테스트에서 뚜렷한 모킹 지점이 되고, 이게 버거워진다면 경고 신호다.